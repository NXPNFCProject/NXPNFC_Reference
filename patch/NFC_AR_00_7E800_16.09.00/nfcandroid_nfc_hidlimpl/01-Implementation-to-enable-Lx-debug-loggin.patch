From a1860d5be0b4c28abf8882e83081bfb38a8daf2d Mon Sep 17 00:00:00 2001
From: nxf56319 <sai.shwethas@nxp.com>
Date: Wed, 15 Oct 2025 14:36:09 +0530
Subject: Implementation to enable Lx debug logging using system property in Android

---
 snxxx/halimpl_v2/hal/phNxpNciHal.cc | 26 ++++++++++++++++++++++----
 snxxx/halimpl_v2/log/phNxpLog.cc    | 29 +++++++++++++++++++++++++----
 2 files changed, 47 insertions(+), 8 deletions(-)

diff --git a/snxxx/halimpl_v2/hal/phNxpNciHal.cc b/snxxx/halimpl_v2/hal/phNxpNciHal.cc
index 97b5988..89f4394 100644
--- a/snxxx/halimpl_v2/hal/phNxpNciHal.cc
+++ b/snxxx/halimpl_v2/hal/phNxpNciHal.cc
@@ -3759,16 +3759,34 @@ static void phNxpNciHal_UpdateFwStatus(HalNfcFwUpdateStatus fwStatus) {
 void phNxpNciHal_configureLxDebugMode() {
   NFCSTATUS status = NFCSTATUS_SUCCESS;
   unsigned long lx_debug_cfg = 0;
-  uint8_t isfound = 0;
+  unsigned long prop_val = 0;
+  unsigned long config_val = 0;
+  bool prop_found = false;
+  bool config_found = false;
   static uint8_t cmd_lxdebug[] = {0x20, 0x02, 0x06, 0x01, 0xA0,
                                   0x1D, 0x02, 0x00, 0x00};
   uint8_t rsp[PHNCI_MAX_DATA_LEN] = {0};
   uint16_t rsp_len = 0;
 
-  isfound = GetNxpNumValue(NAME_NXP_CORE_PROP_SYSTEM_DEBUG, &lx_debug_cfg,
-                           sizeof(lx_debug_cfg));
+  char valueStr[PROPERTY_VALUE_MAX] = {0};
+  int len = property_get("persist.vendor.nfc.nxp.lx_debug_mask", valueStr, "");
+  if (len > 0) {
+    if (sscanf(valueStr, "%lx", &prop_val) == 1) {
+      prop_found = true;
+    }
+  }
+
+  config_found = GetNxpNumValue(NAME_NXP_CORE_PROP_SYSTEM_DEBUG, &config_val,
+      sizeof(config_val));
 
-  if (isfound) {
+  if (prop_found) {
+    lx_debug_cfg |= prop_val;
+  }
+  if (config_found) {
+    lx_debug_cfg |= config_val;
+  }
+
+  if (lx_debug_cfg) {
     if (lx_debug_cfg & LX_DEBUG_CFG_ENABLE_L1_EVENT) {
       NXPLOG_NCIHAL_D("Enable L1 RF NTF debugs");
     }
diff --git a/snxxx/halimpl_v2/log/phNxpLog.cc b/snxxx/halimpl_v2/log/phNxpLog.cc
index a75665d..07b3a88 100644
--- a/snxxx/halimpl_v2/log/phNxpLog.cc
+++ b/snxxx/halimpl_v2/log/phNxpLog.cc
@@ -244,10 +244,31 @@ static void phNxpLog_SetNciTxLogLevel(uint8_t level) {
 static void phNxpLog_setLxLoggingEnabled() {
   gLog_level.is_lx_logging_enabled = false;
   unsigned long lx_debug_cfg = 0;
-  bool isfound = GetNxpNumValue(NAME_NXP_CORE_PROP_SYSTEM_DEBUG, &lx_debug_cfg,
-                                sizeof(lx_debug_cfg));
-  if (!isfound) {
-    return;
+  unsigned long prop_val = 0;
+  unsigned long config_val = 0;
+  bool prop_found = false;
+  bool config_found = false;
+
+  char valueStr[PROPERTY_VALUE_MAX] = {0};
+  int len = property_get("persist.vendor.nfc.nxp.lx_debug_mask", valueStr, "");
+  if (len > 0) {
+    if (sscanf(valueStr, "%lx", &prop_val) == 1) {
+      prop_found = true;
+    }
+  }
+
+  config_found = GetNxpNumValue(NAME_NXP_CORE_PROP_SYSTEM_DEBUG, &config_val,
+      sizeof(config_val));
+
+  if (prop_found) {
+    lx_debug_cfg |= prop_val;
+  }
+  if (config_found) {
+    lx_debug_cfg |= config_val;
+  }
+
+  if (!prop_found && !config_found) {
+    return; // No debug config found
   }
 
   if ((property_get_bool("ro.debuggable", 0) != 0) &&
-- 
2.50.1

